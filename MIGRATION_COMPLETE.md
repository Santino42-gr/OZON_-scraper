# ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Parser Market API –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚ú® –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π API –∫–ª–∏–µ–Ω—Ç
**–§–∞–π–ª:** `backend/services/parser_market_client.py`

- –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Parser Market API
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ `parse_sync()` –¥–ª—è –ø—Ä—è–º–æ–π –∑–∞–º–µ–Ω—ã —Å—Ç–∞—Ä–æ–≥–æ scraper
- Batch –ø–∞—Ä—Å–∏–Ω–≥ `parse_batch()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π polling –∏ –æ–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- Comprehensive error handling –∏ retry –ª–æ–≥–∏–∫–∞
- Mapping —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ API –≤ –º–æ–¥–µ–ª—å `ProductInfo`

### 2. ‚öôÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
**–§–∞–π–ª—ã:** `backend/config.py`, `.env`

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```python
PARSER_MARKET_API_KEY=your-parser-market-api-key-here
PARSER_MARKET_REGION=–ú–æ—Å–∫–≤–∞
PARSER_MARKET_TIMEOUT=120
PARSER_MARKET_POLL_INTERVAL=10
PARSER_MARKET_MAX_RETRIES=3
```

**–£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `PLAYWRIGHT_HEADLESS`
- `PLAYWRIGHT_TIMEOUT`

### 3. üîÑ –û–±–Ω–æ–≤–ª—ë–Ω —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π
**–§–∞–π–ª:** `backend/services/ozon_service.py`

- –ó–∞–º–µ–Ω—ë–Ω –∏–º–ø–æ—Ä—Ç —Å `ozon_scraper` –Ω–∞ `parser_market_client`
- –ú–µ—Ç–æ–¥ `get_product_info()` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Parser Market API
- –£–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –º–µ—Ç–æ–¥—ã `get_product_with_playwright()` –∏ `get_product_with_httpx()`
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å - –≤—Å–µ API —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –æ—Å—Ç–∞–ª–∏—Å—å –ø—Ä–µ–∂–Ω–∏–º–∏

### 4. üõ†Ô∏è –°–æ–∑–¥–∞–Ω SPP –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
**–§–∞–π–ª:** `backend/services/spp_calculator.py`

- –í—ã–Ω–µ—Å–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –°–ü–ü –º–µ—Ç—Ä–∏–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —É—Ç–∏–ª–∏—Ç—É
- –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–µ–∑ –∏–º–ø–æ—Ä—Ç–∞ OzonScraper
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `articles.py` –∏ `price_history_collector.py`

### 5. üåê –û–±–Ω–æ–≤–ª–µ–Ω—ã API endpoints
**–§–∞–π–ª—ã:** `backend/routers/articles.py`, `backend/routers/prices.py`

- `articles.py`: –æ–±–Ω–æ–≤–ª—ë–Ω –∏–º–ø–æ—Ä—Ç SPP –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (—Å—Ç—Ä–æ–∫–∞ 57)
- `prices.py`: –∑–∞–º–µ–Ω—ë–Ω `get_ozon_scraper()` –Ω–∞ `get_ozon_service()` (—Å—Ç—Ä–æ–∫–∞ 357)

### 6. ‚è∞ –û–±–Ω–æ–≤–ª–µ–Ω—ã cron jobs
**–§–∞–π–ª:** `backend/cron_jobs/price_history_collector.py`

- –ó–∞–º–µ–Ω—ë–Ω `OzonScraper` –Ω–∞ `ParserMarketClient`
- –û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ `scrape_article_price()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `calculate_spp_metrics` –∏–∑ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è
- Source –≤ –ë–î —Ç–µ–ø–µ—Ä—å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `"parser_market_api"`

### 7. üóëÔ∏è –£–¥–∞–ª–µ–Ω—ã Playwright —Ñ–∞–π–ª—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–£–¥–∞–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `backend/services/ozon_scraper.py` (~1182 —Å—Ç—Ä–æ–∫–∏)
- `backend/test_ozon_scraper.py`
- `backend/test_scraper_improvements.py`
- `test_single_article.py`
- `test_simple_httpx.py`

**–£–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt`:**
- `playwright==1.48.0` (~200MB)
- `beautifulsoup4==4.12.3`
- `lxml==5.3.0`
- `fake-useragent==1.5.1`

### 8. ‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
**–§–∞–π–ª:** `backend/test_parser_market.py`

- –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞ Parser Market
- –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- –¢–µ—Å—Ç –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
- Comprehensive logging –∏ –æ—Ç—á—ë—Ç—ã

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á Parser Market

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://parser.market/
2. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
3. –î–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ `.env` —Ñ–∞–π–ª:

```bash
PARSER_MARKET_API_KEY=your-actual-api-key-here
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
cd backend
pip install -r requirements.txt
```

**–í–∞–∂–Ω–æ:** Playwright –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω! –≠—Ç–æ —Å—ç–∫–æ–Ω–æ–º–∏—Ç ~250MB –º–µ—Å—Ç–∞.

### –®–∞–≥ 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ Parser Market API

```bash
cd backend
python test_parser_market.py 1669668169
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API
- ‚úÖ –ë–∞–ª–∞–Ω—Å –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend

```bash
cd backend
uvicorn main:app --reload
```

Backend —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Parser Market API –≤–º–µ—Å—Ç–æ Playwright!

### –®–∞–≥ 5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —á–µ—Ä–µ–∑ API

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ç–∏–∫—É–ª–∞
curl -X POST "http://localhost:8000/api/v1/articles/" \
  -H "Content-Type: application/json" \
  -d '{"article_number": "1669668169", "user_id": "your-user-id"}'
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —É–≤–µ–ª–∏—á–∏–ª–æ—Å—å
- **–†–∞–Ω—å—à–µ (Playwright):** 5-30 —Å–µ–∫—É–Ω–¥
- **–¢–µ–ø–µ—Ä—å (Parser Market API):** 30-120 —Å–µ–∫—É–Ω–¥

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! Parser Market –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü–∞—Ä–∞–º–µ—Ç—Ä `use_cache` –≤ `get_product_info()` —Ç–µ–ø–µ—Ä—å –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ Parser Market –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ.

### Source –≤ –ë–î
- Playwright scraper –∑–∞–ø–∏—Å—ã–≤–∞–ª: `source="playwright"` –∏–ª–∏ `source="httpx"`
- Parser Market API –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç: `source="manual"` (–±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏)

### –†–µ–≥–∏–æ–Ω –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–µ–Ω
–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ú–æ—Å–∫–≤—É (–∫–∞–∫ –≤—ã –∏ –ø—Ä–æ—Å–∏–ª–∏).

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏

### –ö–æ–¥
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ: ~1500 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: ~550 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- ‚úÖ –ß–∏—Å—Ç–∞—è —ç–∫–æ–Ω–æ–º–∏—è: ~950 —Å—Ç—Ä–æ–∫

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ: ~250 MB (Playwright + –±—Ä–∞—É–∑–µ—Ä—ã)
- ‚úÖ –†–∞–∑–º–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ —É–º–µ–Ω—å—à–µ–Ω –Ω–∞ 250 MB

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –∞–Ω—Ç–∏–±–æ—Ç–æ–º
- ‚úÖ –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

---

## üîß Troubleshooting

### –û—à–∏–±–∫–∞: "PARSER_MARKET_API_KEY not configured"
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ API –∫–ª—é—á –≤ `.env` —Ñ–∞–π–ª

### –û—à–∏–±–∫–∞: "Task timeout after 120s"
**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á—å—Ç–µ `PARSER_MARKET_TIMEOUT` –≤ `.env`

```bash
PARSER_MARKET_TIMEOUT=180  # 3 –º–∏–Ω—É—Ç—ã
```

### –û—à–∏–±–∫–∞: "Failed to submit task"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞ Parser Market:

```bash
python backend/test_parser_market.py
```

### –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
**–†–µ—à–µ–Ω–∏–µ:** Parser Market –º–æ–∂–µ—Ç –Ω–µ –Ω–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
1. –ê—Ä—Ç–∏–∫—É–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
2. –¢–æ–≤–∞—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ Ozon
3. –¢–æ–≤–∞—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ (–ú–æ—Å–∫–≤–∞)

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
1. ‚úÖ –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á Parser Market
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∞—Ä—Ç–∏–∫—É–ª–∞–º–∏
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –∏ —Ç–∞—Ä–∏—Ñ—ã
4. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ cron job –≤—Ä—É—á–Ω—É—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhooks –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≤–º–µ—Å—Ç–æ polling)
2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å fallback –Ω–∞ httpx –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
4. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ API usage

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Parser Market

- üì± –¢–µ–ª–µ—Ñ–æ–Ω: +7-915-128-98-08
- üìß Email: (—Å–º. –Ω–∞ —Å–∞–π—Ç–µ)
- üí¨ Telegram: (—Å–º. –Ω–∞ —Å–∞–π—Ç–µ)
- üåê –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://parser.market/parser-cen-json-api/

---

## ‚ú® –ì–æ—Ç–æ–≤–æ!

–í–∞—à –ø—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ Parser Market API!

–¢–µ–ø–µ—Ä—å –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å—Å—è –æ:
- ‚ùå Playwright –±—Ä–∞—É–∑–µ—Ä–∞—Ö
- ‚ùå –ê–Ω—Ç–∏–±–æ—Ç —Å–∏—Å—Ç–µ–º–∞—Ö Ozon
- ‚ùå –ü–æ–¥–¥–µ—Ä–∂–∫–µ scraping –ª–æ–≥–∏–∫–∏
- ‚ùå HTTP 403 –æ—à–∏–±–∫–∞—Ö

–í—Å—ë —ç—Ç–æ –±–µ—Ä—ë—Ç –Ω–∞ —Å–µ–±—è Parser Market! üéâ

---

**–ê–≤—Ç–æ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏:** Claude Code
**–î–∞—Ç–∞:** 2025-11-04
**–í–µ—Ä—Å–∏—è:** 1.0
