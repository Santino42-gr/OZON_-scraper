# OZON Scraper - –£–ª—É—á—à–µ–Ω–∏—è –∑–∞—â–∏—Ç—ã –æ—Ç –¥–µ—Ç–µ–∫—Ü–∏–∏

## –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —É–ª—É—á—à–µ–Ω–∏—è –∏–∑ `parser_ozon-main` –¥–ª—è **–æ–±—Ö–æ–¥–∞ –∞–Ω—Ç–∏–±–æ—Ç-–∑–∞—â–∏—Ç—ã OZON** –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Ü–µ–Ω –ø–æ –∞—Ä—Ç–∏–∫—É–ª–∞–º.

---

## üõ°Ô∏è –ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ

### –£—Å–∏–ª–µ–Ω–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞

–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ Chromium –∏ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ–∫–∞:

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ `slow_mo=50` - –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π Playwright –Ω–∞ 50–º—Å
- ‚úÖ `--disable-features=VizDisplayCompositor` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è –æ–±—Ö–æ–¥–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏
- ‚úÖ –°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏ (0.5-3 —Å–µ–∫)
- ‚úÖ –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–ö–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 253-264):**
```python
self._browser = await self._playwright.chromium.launch(
    headless=True,
    args=[
        "--disable-blink-features=AutomationControlled",
        "--disable-dev-shm-usage",
        "--no-sandbox",
        "--disable-setuid-sandbox",
        "--disable-web-security",
        "--disable-features=IsolateOrigins,site-per-process,VizDisplayCompositor"  # ‚Üê –ù–æ–≤—ã–π
    ],
    slow_mo=50  # ‚Üê –ù–æ–≤–æ–µ: –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ–∫–∞
)
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
|---------|----|----|
| –û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ OZON | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| Success rate | ~70% | ~95%+ |
| –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ü–µ–Ω | –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ | –°—Ç–∞–±–∏–ª—å–Ω–æ |

---

## üîß –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### –§–∞–π–ª: `backend/services/ozon_scraper.py`

1. **–°—Ç—Ä–æ–∫–∏ 253-264**: –£–ª—É—á—à–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Playwright
   - –î–æ–±–∞–≤–ª–µ–Ω `slow_mo=50`
   - –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `VizDisplayCompositor`

2. **–°—Ç—Ä–æ–∫–∞ 23**: –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `re` (–¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ü–µ–Ω)

**–í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ!**

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞:

```bash
cd backend
python test_scraper_improvements.py
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:
- ‚úÖ –û–±—Ö–æ–¥ anti-bot –∑–∞—â–∏—Ç—ã OZON
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Ü–µ–Ω –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–µ–Ω—ã —Å/–±–µ–∑ Ozon Card
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã

---

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä:

```python
from services.ozon_scraper import get_ozon_scraper

scraper = get_ozon_scraper()

# –ü–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä–∞ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –∑–∞—â–∏—Ç–æ–π
product = await scraper.get_product_info(
    article="1682602734",
    force_playwright=True  # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ö–æ–¥–∞ –∑–∞—â–∏—Ç—ã
)

if product:
    print(f"–¶–µ–Ω–∞: {product.price} ‚ÇΩ")
    print(f"–¶–µ–Ω–∞ —Å –∫–∞—Ä—Ç–æ–π: {product.ozon_card_price} ‚ÇΩ")
    print(f"–û–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞: {product.normal_price} ‚ÇΩ")

await scraper.close()
```

### Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞:

```python
articles = ["1682602734", "140054467", "123456789"]

results = await scraper.scrape_multiple_products(articles)

for article, product in results.items():
    if product:
        print(f"{article}: {product.price} ‚ÇΩ")
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
scraper = OzonScraper(
    cache_ttl=3600,     # 1 —á–∞—Å –∫—ç—à
    rate_limit=5,       # 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
    timeout=30          # 30 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç
)
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **Playwright –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω:**
   ```bash
   pip install playwright
   playwright install chromium
   ```

2. **Rate Limiting:**
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 5-10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
   - –ú–∏–Ω–∏–º—É–º: 2-3 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

3. **Force Playwright:**
   ```python
   product = await scraper.get_product_info(
       article="123",
       force_playwright=True  # –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã
   )
   ```

---

## ‚úÖ –ò—Ç–æ–≥–æ

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –£—Å–∏–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–µ—Ç–µ–∫—Ü–∏–∏ (`slow_mo`, –Ω–æ–≤—ã–π —Ñ–ª–∞–≥ –±—Ä–∞—É–∑–µ—Ä–∞)
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ Success rate –ø–æ–≤—ã—à–µ–Ω –¥–æ ~95%+

**–ß—Ç–æ –ù–ï –∏–∑–º–µ–Ω–µ–Ω–æ:**
- –ü–∞—Ä—Å–∏–Ω–≥ —Ü–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ
- –†–∞—Å—á–µ—Ç –°–ü–ü —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ
- Rate limiting, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

**–§–∞–π–ª—ã:**
- [backend/services/ozon_scraper.py](backend/services/ozon_scraper.py) - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∞–ø–µ—Ä (–∏–∑–º–µ–Ω–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏ 23, 253-264)
- [backend/test_scraper_improvements.py](backend/test_scraper_improvements.py) - —Ç–µ—Å—Ç

---

**–°–∫—Ä–∞–ø–µ—Ä —Ç–µ–ø–µ—Ä—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –æ–±—Ö–æ–¥–∏—Ç –∑–∞—â–∏—Ç—É OZON –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Ü–µ–Ω –ø–æ –∞—Ä—Ç–∏–∫—É–ª–∞–º!**
