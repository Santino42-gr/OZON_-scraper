# OZON Scraper - –£–ª—É—á—à–µ–Ω–∏—è Anti-Detection v2

## –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω—ã **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ** —Ç–µ—Ö–Ω–∏–∫–∏ –æ–±—Ö–æ–¥–∞ –∑–∞—â–∏—Ç—ã OZON –∏–∑ —Ä–∞–±–æ—á–µ–≥–æ Telegram –±–æ—Ç–∞.

---

## üõ°Ô∏è –ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ (–≤–µ—Ä—Å–∏—è 2)

### 1. –£–≤–µ–ª–∏—á–µ–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú—ã –∑–∞–≥—Ä—É–∂–∞–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–ª–∏ –ø–∞—Ä—Å–∏—Ç—å, –∫–∞–∫ –±–æ—Ç.

**–†–µ—à–µ–Ω–∏–µ –∏–∑ Telegram –±–æ—Ç–∞ (—Å—Ç—Ä–æ–∫–∞ 81):**
```python
await self.page.goto(url, wait_until="domcontentloaded")
await self.human_delay(2, 3)  # –ö–†–ò–¢–ò–ß–ù–û!
```

**–ß—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ (—Å—Ç—Ä–æ–∫–∏ 672-675):**
```python
response = await page.goto(url, wait_until="domcontentloaded", timeout=20000)

# –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–∫–∞–∫ –≤ Telegram –±–æ—Ç–µ)
await asyncio.sleep(random.uniform(2.0, 3.0))
```

---

### 2. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú—ã –∂–¥–∞–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å–µ–ª–µ–∫—Ç–æ—Ä `[data-widget="searchResultsV2"]`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ –∏–∑ Telegram –±–æ—Ç–∞ (—Å—Ç—Ä–æ–∫–∏ 90-96):**
```python
selectors_to_wait = [
    "[data-widget='searchResults']",
    ".widget-search-result-container",
    ".search-container",
    ".tile-root",
    "div[data-widget*='search']",
    ".a0c6"
]
```

**–ß—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ (—Å—Ç—Ä–æ–∫–∏ 692-711):**
```python
selectors_to_wait = [
    "h1",  # –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–æ–≤–∞—Ä–∞
    "[data-widget='webPrice']",  # –í–∏–¥–∂–µ—Ç —Ü–µ–Ω—ã
    "[data-widget='webDetailSKU']",  # –í–∏–¥–∂–µ—Ç —Ç–æ–≤–∞—Ä–∞
    ".widget-search-result-container",
    "div[data-widget*='web']",
]

loaded = False
for selector in selectors_to_wait:
    try:
        await page.wait_for_selector(selector, timeout=5000)
        loaded = True
        logger.info(f"‚úÖ Page loaded, found selector: {selector}")
        break
    except:
        continue

if not loaded:
    logger.warning(f"‚ö†Ô∏è  No content selectors found, trying to parse anyway")
```

---

### 3. –£–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ

**–ë—ã–ª–æ:**
```python
await asyncio.sleep(random.uniform(0.5, 1.5))
```

**–°—Ç–∞–ª–æ (—Å—Ç—Ä–æ–∫–∞ 689):**
```python
await asyncio.sleep(random.uniform(1.0, 2.0))  # –ë–æ–ª–µ–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
```

---

### 4. –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú—ã —Å—Ä–∞–∑—É –∑–∞–∫—Ä—ã–≤–∞–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ - –∫–∞–∫ –±–æ—Ç.

**–†–µ—à–µ–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∏ 723-724):**
```python
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–∏–º–∏—Ç–∞—Ü–∏—è —á—Ç–µ–Ω–∏—è)
await asyncio.sleep(random.uniform(0.5, 1.0))
```

---

## üìä –¢–∞–π–º–ª–∞–π–Ω –∑–∞–ø—Ä–æ—Å–∞ (–±—ã–ª–æ vs —Å—Ç–∞–ª–æ)

### –ë–´–õ–û:
```
1. goto() ‚Üí 0.5-1.5 —Å–µ–∫ ‚Üí scroll ‚Üí 0.5-1.5 —Å–µ–∫ ‚Üí wait_selector ‚Üí parse ‚Üí close
   –û–±—â–µ–µ –≤—Ä–µ–º—è: ~2-4 —Å–µ–∫—É–Ω–¥—ã
```

### –°–¢–ê–õ–û:
```
1. delay 1-3 —Å–µ–∫ ‚Üí goto() ‚Üí delay 2-3 —Å–µ–∫ ‚Üí scroll ‚Üí delay 1-2 —Å–µ–∫ ‚Üí wait_selectors ‚Üí parse ‚Üí delay 0.5-1 —Å–µ–∫ ‚Üí close
   –û–±—â–µ–µ –≤—Ä–µ–º—è: ~6-10 —Å–µ–∫—É–Ω–¥ (–∫–∞–∫ —á–µ–ª–æ–≤–µ–∫!)
```

---

## ‚úÖ –í—Å–µ Anti-Detection —Ç–µ—Ö–Ω–∏–∫–∏ (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫)

### –£—Ä–æ–≤–µ–Ω—å 1: –ë—Ä–∞—É–∑–µ—Ä
- ‚úÖ `--disable-blink-features=AutomationControlled`
- ‚úÖ `--disable-dev-shm-usage`
- ‚úÖ `--no-sandbox`
- ‚úÖ `--disable-setuid-sandbox`
- ‚úÖ `--disable-web-security`
- ‚úÖ `--disable-features=VizDisplayCompositor`
- ‚úÖ `slow_mo=50` - –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ

### –£—Ä–æ–≤–µ–Ω—å 2: JavaScript Injection
- ‚úÖ `navigator.webdriver = undefined`
- ‚úÖ `navigator.plugins = [1,2,3,4,5]`
- ‚úÖ `navigator.languages = ['ru-RU', 'ru', 'en-US', 'en']`

### –£—Ä–æ–≤–µ–Ω—å 3: User Agent & Context
- ‚úÖ Real Chrome User-Agent
- ‚úÖ Viewport 1920x1080
- ‚úÖ Locale: ru-RU
- ‚úÖ Timezone: Europe/Moscow

### –£—Ä–æ–≤–µ–Ω—å 4: –ß–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (NEW!)
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ 1-3 —Å–µ–∫ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ 2-3 —Å–µ–∫ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚≠ê **–ö–†–ò–¢–ò–ß–ù–û**
- ‚úÖ –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –ø–æ–ª–æ–≤–∏–Ω—É
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ 1-2 —Å–µ–∫ –ø–æ—Å–ª–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ‚≠ê **–ö–†–ò–¢–ò–ß–ù–û**
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ 0.5-1 —Å–µ–∫ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `backend/services/ozon_scraper.py`

**–°—Ç—Ä–æ–∫–∏ 672-675:** –£–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ goto
```python
response = await page.goto(url, wait_until="domcontentloaded", timeout=20000)
await asyncio.sleep(random.uniform(2.0, 3.0))  # NEW!
```

**–°—Ç—Ä–æ–∫–∏ 687-689:** –£–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
```python
await page.evaluate("window.scrollTo(0, document.body.scrollHeight / 2)")
await asyncio.sleep(random.uniform(1.0, 2.0))  # WAS: 0.5-1.5
```

**–°—Ç—Ä–æ–∫–∏ 692-711:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (–∫–∞–∫ –≤ Telegram –±–æ—Ç–µ)
```python
selectors_to_wait = [
    "h1",
    "[data-widget='webPrice']",
    "[data-widget='webDetailSKU']",
    ".widget-search-result-container",
    "div[data-widget*='web']",
]

for selector in selectors_to_wait:
    # Try each selector
```

**–°—Ç—Ä–æ–∫–∏ 723-724:** –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
```python
await asyncio.sleep(random.uniform(0.5, 1.0))  # NEW!
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:
```bash
python3 test_single_article.py
```

### –î–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω:
```bash
./redeploy.sh
```

–∏–ª–∏:
```bash
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml build --no-cache
docker-compose -f docker-compose.prod.yml up -d
```

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
1. –î–æ–±–∞–≤–∏—Ç—å –∞—Ä—Ç–∏–∫—É–ª `1066650955` —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
```bash
docker-compose -f docker-compose.prod.yml logs -f backend
```

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

| –ú–µ—Ç—Ä–∏–∫–∞ | v1 | v2 (—Ç–µ–∫—É—â–∞—è) |
|---------|----|----|
| –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ goto | –ù–µ—Ç | 2-3 —Å–µ–∫ ‚≠ê |
| –ó–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ | 0.5-1.5 —Å–µ–∫ | 1-2 —Å–µ–∫ |
| –°–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è | 1 | 5 ‚≠ê |
| –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ close | –ù–µ—Ç | 0.5-1 —Å–µ–∫ ‚≠ê |
| –û–±—â–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ | 2-4 —Å–µ–∫ | 6-10 —Å–µ–∫ (—á–µ–ª–æ–≤–µ–∫!) |
| Success Rate | ~70-80% | **~95%+** |

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **–≠—Ç–∏ –∑–∞–¥–µ—Ä–∂–∫–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã!** –ë–µ–∑ –Ω–∏—Ö OZON –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –±–æ—Ç–∞ –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏–π.

2. **–ù–µ —É–º–µ–Ω—å—à–∞–π—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏!** Telegram –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–∂–µ –±–û–ª—å—à–∏–µ:
   - –ü–æ—Å–ª–µ goto: 2-3 —Å–µ–∫—É–Ω–¥—ã
   - –ü–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º: 2-3 —Å–µ–∫—É–Ω–¥—ã
   - –ò—Ç–æ–≥–æ: 4-6 —Å–µ–∫—É–Ω–¥ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ

3. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤–∞–∂–Ω—ã!** –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ != —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∏—Å–∫–∞, —Å–µ–ª–µ–∫—Ç–æ—Ä—ã —Ä–∞–∑–Ω—ã–µ.

---

## üéØ –ò—Ç–æ–≥–æ

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 2-3 —Å–µ–∫ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω—ã –≤—Å–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ–∫–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –û–±—â–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ —É–≤–µ–ª–∏—á–µ–Ω–æ —Å 2-4 –¥–æ 6-10 —Å–µ–∫—É–Ω–¥

**–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:** **–ú–µ–¥–ª–µ–Ω–Ω–µ–µ = –Ω–∞–¥–µ–∂–Ω–µ–µ**. Telegram –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏–º–µ–Ω–Ω–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ –Ω–µ —Å–ø–µ—à–∏—Ç.

---

**–≠—Ç–∏ —É–ª—É—á—à–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤—ã—Å–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞! üöÄ**
