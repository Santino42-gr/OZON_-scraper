# Тестирование аутентификации - OZON Bot Admin

## Подготовка к тестированию

### 1. Убедитесь, что установлены зависимости

```bash
cd frontend
npm install
```

### 2. Создайте тестового пользователя

Следуйте инструкциям в [AUTH_SETUP.md](./AUTH_SETUP.md):

1. Создайте пользователя в Supabase Auth Dashboard
2. Выполните миграцию `005_add_test_admin.sql`

### 3. Проверьте .env файл

Убедитесь, что файл `frontend/.env` содержит:

```env
VITE_SUPABASE_URL=https://kknxajmrtexzzlqgvlxg.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## Запуск приложения

```bash
cd frontend
npm run dev
```

Откройте браузер по адресу: `http://localhost:5173`

## Тестовые сценарии

### ✅ Сценарий 1: Успешный вход

**Шаги:**
1. Откройте `/login`
2. Введите:
   - Email: `admin@ozonbot.dev`
   - Password: `admin123456`
3. Нажмите "Войти"

**Ожидаемый результат:**
- ✅ Toast уведомление "Успешный вход"
- ✅ Редирект на Dashboard `/`
- ✅ В хедере отображается email пользователя
- ✅ Кнопка выхода доступна

### ❌ Сценарий 2: Неверные учетные данные

**Шаги:**
1. Откройте `/login`
2. Введите неверный пароль
3. Нажмите "Войти"

**Ожидаемый результат:**
- ❌ Alert с ошибкой "Invalid login credentials"
- ❌ Toast уведомление об ошибке
- ❌ Остаетесь на странице входа

### ✅ Сценарий 3: Валидация формы

**Email валидация:**
1. Введите невалидный email: `test@`
2. Попытайтесь отправить форму

**Ожидаемый результат:**
- ❌ Сообщение об ошибке "Введите корректный email"
- ❌ Форма не отправляется

**Пароль валидация:**
1. Введите короткий пароль: `12345`
2. Попытайтесь отправить форму

**Ожидаемый результат:**
- ❌ Сообщение "Пароль должен содержать минимум 6 символов"
- ❌ Форма не отправляется

### ✅ Сценарий 4: Защищенные маршруты

**Шаги:**
1. Откройте приложение в режиме инкогнито
2. Попробуйте открыть `/` или `/dashboard` напрямую

**Ожидаемый результат:**
- ✅ Автоматический редирект на `/login`
- ✅ Loading screen отображается корректно

### ✅ Сценарий 5: Выход из системы

**Шаги:**
1. Войдите в систему
2. Нажмите кнопку выхода (иконка LogOut)
3. Подтвердите выход в диалоге

**Ожидаемый результат:**
- ✅ Dialog с подтверждением отображается
- ✅ Toast уведомление "Выход выполнен"
- ✅ Редирект на `/login`
- ✅ Сессия очищена

### ✅ Сценарий 6: Восстановление сессии

**Шаги:**
1. Войдите в систему
2. Обновите страницу (F5)

**Ожидаемый результат:**
- ✅ Loading screen кратковременно показывается
- ✅ Сессия восстанавливается
- ✅ Остаетесь на Dashboard
- ✅ Email отображается в хедере

### ✅ Сценарий 7: Сброс пароля

**Шаги:**
1. Откройте `/login`
2. Нажмите "Забыли пароль?"
3. Введите email: `admin@ozonbot.dev`
4. Нажмите "Отправить инструкции"

**Ожидаемый результат:**
- ✅ Редирект на `/reset-password`
- ✅ Форма с полем email отображается
- ✅ После отправки показывается success сообщение
- ✅ Toast уведомление "Письмо отправлено"
- ✅ Кнопка "Вернуться ко входу" работает

### ✅ Сценарий 8: Автоматический редирект

**Шаги:**
1. Войдите в систему
2. Попробуйте открыть `/login` напрямую

**Ожидаемый результат:**
- ✅ Автоматический редирект на Dashboard
- ✅ Не видите страницу входа

## Проверка состояния

### Проверка через DevTools

Откройте Browser DevTools (F12) и проверьте:

**Application / Local Storage:**
```
supabase.auth.token
```
Должен содержать JWT токен после успешного входа.

**Console:**
Не должно быть ошибок при:
- Загрузке страницы
- Входе в систему
- Выходе из системы
- Навигации между страницами

### Проверка через Supabase Dashboard

1. Откройте [Authentication → Logs](https://supabase.com/dashboard/project/kknxajmrtexzzlqgvlxg/auth/logs)
2. Проверьте логи аутентификации:
   - `user.signed_in` при успешном входе
   - `user.signed_out` при выходе

## Известные проблемы

### Email не отправляется при сбросе пароля

**Причина:** SMTP не настроен в Supabase

**Решение (временное):**
- Используйте Supabase Dashboard для сброса пароля вручную
- Настройте SMTP в Authentication → Email Settings

### Долгая загрузка при первом запуске

**Причина:** Холодный старт Supabase

**Решение:** Это нормально для первого запроса, последующие будут быстрее

## Тестирование производительности

### Время загрузки

- **Login page**: < 1s
- **Dashboard after login**: < 2s
- **Session restore**: < 500ms

### Сетевые запросы

Проверьте в Network tab:
- Supabase auth requests должны возвращать 200 OK
- Токены должны обновляться автоматически

## Чек-лист для релиза

- [ ] Все тесты выше проходят успешно
- [ ] Нет console errors
- [ ] Нет linter warnings
- [ ] UI выглядит корректно на desktop и mobile
- [ ] Transitions плавные
- [ ] Toast уведомления работают
- [ ] Все тексты на русском
- [ ] Валидация форм работает
- [ ] Loading states отображаются
- [ ] Error states обрабатываются

---

**Дата создания:** 2025-10-20  
**Версия:** 1.0.0

