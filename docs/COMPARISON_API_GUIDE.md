# Comparison API - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

> **–í–µ—Ä—Å–∏—è:** 1.0.0
> **–ë–∞–∑–æ–≤—ã–π URL:** `/api/v1/comparison`

---

## üìã –û–±–∑–æ—Ä

Comparison API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç endpoints –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∞—Ä—Ç–∏–∫—É–ª–æ–≤ OZON —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ç–∏–∫—É–ª–æ–≤ –≤ –≥—Ä—É–ø–ø—ã
- ‚úÖ –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å–Ω—ç–ø—à–æ—Ç—ã)
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üöÄ Quick Start

### –ë—ã—Å—Ç—Ä–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ 1v1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

```bash
POST /api/v1/comparison/quick-compare?user_id={uuid}
Content-Type: application/json

{
  "own_article_number": "123456789",
  "competitor_article_number": "987654321",
  "group_name": "–ú–æ–π —Ç–æ–≤–∞—Ä vs –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç A",
  "scrape_now": true
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "group_id": "uuid",
  "group_name": "–ú–æ–π —Ç–æ–≤–∞—Ä vs –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç A",
  "group_type": "comparison",
  "own_product": {
    "article_id": "uuid",
    "article_number": "123456789",
    "name": "–¢–æ–≤–∞—Ä –ê",
    "price": 5000,
    "rating": 4.5,
    "spp_total": 15.5,
    ...
  },
  "competitors": [{
    "article_id": "uuid",
    "article_number": "987654321",
    "name": "–¢–æ–≤–∞—Ä –ë",
    "price": 4800,
    "rating": 4.7,
    "spp_total": 20.0,
    ...
  }],
  "metrics": {
    "price": {
      "absolute": 200,
      "percentage": 4.17,
      "who_cheaper": "competitor",
      "recommendation": "–°–Ω–∏–∑—å—Ç–µ —Ü–µ–Ω—É –Ω–∞ 4.2% –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏"
    },
    "rating": {
      "absolute": -0.2,
      "percentage": -4.26,
      "who_better": "competitor",
      "recommendation": "–†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ –∫–∞—á–µ—Å—Ç–≤–æ–º - —Ä–µ–π—Ç–∏–Ω–≥ –Ω–∏–∂–µ –Ω–∞ 0.20"
    },
    "spp": {
      "absolute": -4.5,
      "percentage": -22.5,
      "who_better": "competitor",
      "recommendation": "–£–≤–µ–ª–∏—á—å—Ç–µ —Å–∫–∏–¥–∫–∏ - –°–ü–ü –Ω–∏–∂–µ –Ω–∞ 4.5%"
    },
    "reviews": {
      "absolute": -150,
      "percentage": -30,
      "who_more": "competitor",
      "recommendation": "–£ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ –±–æ–ª—å—à–µ –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ 150"
    },
    "competitiveness_index": 0.67,
    "grade": "C",
    "overall_recommendation": "–ì—Ä–µ–π–¥ C (0.67): –°–Ω–∏–∑—å—Ç–µ —Ü–µ–Ω—É, –£–ª—É—á—à–∞–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞"
  },
  "compared_at": "2025-10-30T18:30:00Z",
  "is_fresh": true
}
```

---

## üìö API Endpoints

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏

#### –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É
```http
POST /api/v1/comparison/groups?user_id={uuid}
Content-Type: application/json

{
  "name": "–ì—Ä—É–ø–ø–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è 1",
  "group_type": "comparison"  // comparison | variants | similar
}
```

#### –ü–æ–ª—É—á–∏—Ç—å –≥—Ä—É–ø–ø—É
```http
GET /api/v1/comparison/groups/{group_id}?user_id={uuid}
```

#### –£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É
```http
DELETE /api/v1/comparison/groups/{group_id}?user_id={uuid}
```

---

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–ª–µ–Ω–∞–º–∏ –≥—Ä—É–ø–ø—ã

#### –î–æ–±–∞–≤–∏—Ç—å –∞—Ä—Ç–∏–∫—É–ª –≤ –≥—Ä—É–ø–ø—É
```http
POST /api/v1/comparison/groups/{group_id}/members
Content-Type: application/json

{
  "article_id": "uuid",
  "role": "own",  // own | competitor | item
  "position": 0
}
```

---

### 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

#### –ü–æ–ª—É—á–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
```http
GET /api/v1/comparison/groups/{group_id}/compare
  ?user_id={uuid}
  &refresh=false
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` - UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (required)
- `refresh` - –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å OZON –ø–µ—Ä–µ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º (optional, default: false)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `refresh=true`:**
- –¶–µ–Ω—ã –º–æ–≥–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è
- –ù—É–∂–Ω—ã —Å–∞–º—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–æ—à–ª–æ > 1 —á–∞—Å–∞ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `refresh=false`:**
- –î–∞–Ω–Ω—ã–µ —É–∂–µ —Å–≤–µ–∂–∏–µ (< 1 —á–∞—Å–∞)
- –ù—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç
- –≠–∫–æ–Ω–æ–º–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OZON

---

### 4. –ò—Å—Ç–æ—Ä–∏—è

#### –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–Ω—ç–ø—à–æ—Ç–æ–≤
```http
GET /api/v1/comparison/groups/{group_id}/history
  ?user_id={uuid}
  &days=30
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` - UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (required)
- `days` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –∏—Å—Ç–æ—Ä–∏–∏: 1-365 (optional, default: 30)

**–û—Ç–≤–µ—Ç:**
```json
{
  "group_id": "uuid",
  "snapshots": [
    {
      "id": "uuid",
      "snapshot_date": "2025-10-30T18:00:00Z",
      "comparison_data": { /* –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ */ },
      "metrics": { /* –º–µ—Ç—Ä–∏–∫–∏ */ },
      "competitiveness_index": 0.67
    },
    ...
  ],
  "total_count": 15,
  "date_from": "2025-10-01T00:00:00Z",
  "date_to": "2025-10-30T23:59:59Z"
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω
- –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤–∞—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤

---

### 5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```http
GET /api/v1/comparison/users/{user_id}/stats
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "total_groups": 5,
  "comparison_groups": 3,
  "total_articles": 12,
  "avg_competitiveness_index": 0.72,
  "last_comparison_date": "2025-10-30T18:30:00Z"
}
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

### –ò–Ω–¥–µ–∫—Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (0-1)

–í–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞:
```
index = price_score * 0.35 +
        rating_score * 0.25 +
        spp_score * 0.20 +
        reviews_score * 0.10 +
        availability_score * 0.10
```

### –ì—Ä–µ–π–¥—ã

| –ì—Ä–µ–π–¥ | –î–∏–∞–ø–∞–∑–æ–Ω | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| A     | 0.85-1.00 | –û—Ç–ª–∏—á–Ω–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å |
| B     | 0.70-0.84 | –•–æ—Ä–æ—à–∞—è |
| C     | 0.50-0.69 | –°—Ä–µ–¥–Ω—è—è |
| D     | 0.30-0.49 | –ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ |
| F     | 0.00-0.29 | –ü–ª–æ—Ö–∞—è |

---

## üîß –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ë—ã—Å—Ç—Ä–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–º

```bash
# –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
curl -X POST "http://localhost:8000/api/v1/comparison/quick-compare?user_id=USER_ID" \
  -H "Content-Type: application/json" \
  -d '{
    "own_article_number": "123456",
    "competitor_article_number": "789012",
    "scrape_now": true
  }'

# –ü–æ–ª—É—á–∞–µ–º group_id –∏ –º–µ—Ç—Ä–∏–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏

```bash
# –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
curl "http://localhost:8000/api/v1/comparison/groups/GROUP_ID/compare?user_id=USER_ID"

# –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞ –º–µ—Å—è—Ü
curl "http://localhost:8000/api/v1/comparison/groups/GROUP_ID/history?user_id=USER_ID&days=30"

# –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è competitiveness_index
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏

```bash
# –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É
curl -X POST "http://localhost:8000/api/v1/comparison/groups?user_id=USER_ID" \
  -H "Content-Type: application/json" \
  -d '{"name": "–ú–æ–π —Ç–æ–≤–∞—Ä vs 3 –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞"}'

# –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π —Ç–æ–≤–∞—Ä
curl -X POST "http://localhost:8000/api/v1/comparison/groups/GROUP_ID/members" \
  -H "Content-Type: application/json" \
  -d '{
    "article_id": "ARTICLE_ID_1",
    "role": "own",
    "position": 0
  }'

# –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
curl -X POST "http://localhost:8000/api/v1/comparison/groups/GROUP_ID/members" \
  -H "Content-Type: application/json" \
  -d '{
    "article_id": "ARTICLE_ID_2",
    "role": "competitor",
    "position": 1
  }'

# –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–ª—è –¥—Ä—É–≥–∏—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤...

# –®–∞–≥ 4: –ü–æ–ª—É—á–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
curl "http://localhost:8000/api/v1/comparison/groups/GROUP_ID/compare?user_id=USER_ID"
```

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –õ–∏–º–∏—Ç—ã:
- –ú–∞–∫—Å–∏–º—É–º 365 –¥–Ω–µ–π –∏—Å—Ç–æ—Ä–∏–∏
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ 5 –∞—Ä—Ç–∏–∫—É–ª–æ–≤ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ
- –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è 1v1 —Å—Ä–∞–≤–Ω–µ–Ω–∏–π

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `quick-compare` –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–π
- –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ `group_id` –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ `is_fresh` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `refresh=true` –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–Ω—ç–ø—à–æ—Ç—ã:
- –°–Ω—ç–ø—à–æ—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏
- –°—Ç–∞—Ä—ã–µ —Å–Ω—ç–ø—à–æ—Ç—ã (> 90 –¥–Ω–µ–π) —É–¥–∞–ª—è—é—Ç—Å—è cron job'–æ–º
- –î–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ

---

## üêõ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ö–æ–¥—ã –æ—à–∏–±–æ–∫:

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|-----|----------|---------|
| 404 | –ì—Ä—É–ø–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ group_id |
| 400 | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ | –î–æ–±–∞–≤—å—Ç–µ own –∏ competitor |
| 409 | –ê—Ä—Ç–∏–∫—É–ª —É–∂–µ –≤ –≥—Ä—É–ø–ø–µ | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∞—Ä—Ç–∏–∫—É–ª |
| 500 | –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ | –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –ø–æ–∑–∂–µ |

### –ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏:
```json
{
  "detail": "Group not found: Group abc-123 not found"
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Health Check:
```bash
curl http://localhost:8000/api/v1/comparison/health
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "module": "comparison",
  "version": "1.0.0",
  "features": [
    "group_management",
    "comparison_metrics",
    "competitiveness_index",
    "snapshots",
    "recommendations"
  ]
}
```

---

## üìñ Swagger Documentation

–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

- **Swagger UI:** http://localhost:8000/docs
- **ReDoc:** http://localhost:8000/redoc

–¢–∞–º –≤—ã –º–æ–∂–µ—Ç–µ:
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ endpoints
- –£–≤–∏–¥–µ—Ç—å —Å—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
- –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Ready for production
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-30
