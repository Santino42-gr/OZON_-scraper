# Changelog

## [2025-10-21] - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –°–ü–ü

### ‚ú® –î–æ–±–∞–≤–ª–µ–Ω–æ

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `ozon_scraper_articles`: `spp1`, `spp2`, `spp_total`
- –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `ozon_scraper_price_history`: `spp1`, `spp2`, `spp_total`
- SQL —Ñ—É–Ω–∫—Ü–∏—è `calculate_spp_metrics(article_number)` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
- SQL —Ñ—É–Ω–∫—Ü–∏—è `update_article_spp_metrics(article_number)` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –°–ü–ü –∞—Ä—Ç–∏–∫—É–ª–∞
- SQL —Ñ—É–Ω–∫—Ü–∏—è `update_all_spp_metrics()` –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –°–ü–ü
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –°–ü–ü: `idx_ozon_scraper_articles_spp_total`, `idx_ozon_scraper_articles_spp1`
- –ú–∏–≥—Ä–∞—Ü–∏—è `007_add_spp_metrics_to_articles.sql`

#### Backend Models
- –ü–æ–ª—è `spp1`, `spp2`, `spp_total` –≤ `ArticleBase` (`backend/models/article.py`)
- –ü–æ–ª—è `spp1`, `spp2`, `spp_total` –≤ `ArticleUpdate` (`backend/models/article.py`)
- –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å `SPPMetrics` —Å –º–µ—Ç–æ–¥–∞–º–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (`backend/models/ozon_models.py`)

#### Backend Services
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ `OzonScraper.calculate_spp_metrics()` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π (`backend/services/ozon_scraper.py`)

#### Backend API
- Endpoint `GET /api/v1/articles/{article_id}/spp` - –ø–æ–ª—É—á–µ–Ω–∏–µ –°–ü–ü –º–µ—Ç—Ä–∏–∫
- Endpoint `POST /api/v1/articles/update-all-spp` - –º–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –°–ü–ü
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –°–ü–ü –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞—Ä—Ç–∏–∫—É–ª–∞ (`backend/routers/articles.py`)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –°–ü–ü –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω (`backend/routers/prices.py`)

#### Telegram Bot
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –°–ü–ü –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –æ–± –∞—Ä—Ç–∏–∫—É–ª–∞—Ö (`bot/utils/formatters.py` - `format_article_info()`)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –°–ü–ü –≤ –æ—Ç—á–µ—Ç–∞—Ö (`bot/utils/formatters.py` - `format_report()`)
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –æ–¥–∏–Ω –∑–Ω–∞–∫ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π, "–ù/–î" –¥–ª—è NULL –∑–Ω–∞—á–µ–Ω–∏–π

#### Frontend
- –ü–æ–ª—è `spp1`, `spp2`, `spp_total` –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ `Article` (`frontend/src/types/crud.ts`)
- –ö–æ–ª–æ–Ω–∫–∏ –°–ü–ü1, –°–ü–ü2, –°–ü–ü –û–±—â –≤ —Ç–∞–±–ª–∏—Ü–µ –∞—Ä—Ç–∏–∫—É–ª–æ–≤ (`frontend/src/pages/Articles.tsx`)
- –ö—Ä–∞—Å–∏–≤–∞—è —Å–µ–∫—Ü–∏—è —Å –°–ü–ü –º–µ—Ç—Ä–∏–∫–∞–º–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –¥–µ—Ç–∞–ª–µ–π –∞—Ä—Ç–∏–∫—É–ª–∞

#### Cron Job
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –°–ü–ü –ø—Ä–∏ —Å–±–æ—Ä–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ü–µ–Ω (`backend/cron_jobs/price_history_collector.py`)

#### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –°–ü–ü: `docs/SPP_METRICS.md`
- –°–≤–æ–¥–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: `docs/SPP_IMPLEMENTATION_SUMMARY.md`
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: `docs/SPP_TESTING_RESULTS.md`
- –û–±–Ω–æ–≤–ª–µ–Ω `README.md` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `backend/test_spp_metrics.py`
- Unit-—Ç–µ—Å—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ –°–ü–ü (4 —Ç–µ—Å—Ç–∞)
- Unit-—Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–∏ SPPMetrics (3 —Ç–µ—Å—Ç–∞)

### üîß –ò–∑–º–µ–Ω–µ–Ω–æ
- –û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ç–∏–∫—É–ª–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –°–ü–ü
- –û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –°–ü–ü
- –†–∞—Å—à–∏—Ä–µ–Ω cron job –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–∞ –°–ü–ü –≤ –∏—Å—Ç–æ—Ä–∏—é —Ü–µ–Ω

### üìä –§–æ—Ä–º—É–ª—ã –°–ü–ü

```
–°–ü–ü1 = (–°—Ä–µ–¥–Ω—è—è –∑–∞ 7 –¥–Ω–µ–π - –û–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞) / –°—Ä–µ–¥–Ω—è—è –∑–∞ 7 –¥–Ω–µ–π √ó 100%
–°–ü–ü2 = (–û–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞ - –¶–µ–Ω–∞ —Å –∫–∞—Ä—Ç–æ–π) / –û–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞ √ó 100%
–°–ü–ü –û–±—â–∏–π = (–°—Ä–µ–¥–Ω—è—è –∑–∞ 7 –¥–Ω–µ–π - –¶–µ–Ω–∞ —Å –∫–∞—Ä—Ç–æ–π) / –°—Ä–µ–¥–Ω—è—è –∑–∞ 7 –¥–Ω–µ–π √ó 100%
```

### ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –í—Å–µ unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã (7/7)
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ NULL –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã

### üìù –ü—Ä–∏–º–µ—Ä—ã

#### Python
```python
from services.ozon_scraper import OzonScraper

spp = OzonScraper.calculate_spp_metrics(
    average_price_7days=1200.0,
    normal_price=900.0,
    ozon_card_price=810.0
)
# {'spp1': 25.0, 'spp2': 10.0, 'spp_total': 32.5}
```

#### SQL
```sql
-- –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –°–ü–ü
SELECT * FROM calculate_spp_metrics('123456789');

-- –û–±–Ω–æ–≤–∏—Ç—å –°–ü–ü
SELECT update_article_spp_metrics('123456789');

-- –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
SELECT update_all_spp_metrics();
```

#### API
```bash
# –ü–æ–ª—É—á–∏—Ç—å –°–ü–ü
curl http://localhost:8000/api/v1/articles/{id}/spp

# –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
curl -X POST http://localhost:8000/api/v1/articles/update-all-spp
```

### üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ | ‚úÖ |
| SQL —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ | ‚úÖ |
| –°–ü–ü —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞—Ä—Ç–∏–∫—É–ª–∞ | ‚úÖ |
| –°–ü–ü —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î | ‚úÖ |
| –°–ü–ü –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Telegram –±–æ—Ç–µ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º X.X% | ‚úÖ |
| –°–ü–ü –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ | ‚úÖ |
| –ü—Ä–∏ NULL –∑–Ω–∞—á–µ–Ω–∏—è—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "–ù/–î" | ‚úÖ |
| –ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –°–ü–ü | ‚úÖ |

---

## –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

### [2025-10-20] - –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã OZON (AIL-305)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ü–µ–Ω (–æ–±—ã—á–Ω–∞—è, Ozon Card, —Å—Ç–∞—Ä–∞—è)
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã –∑–∞ 7 –¥–Ω–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω –≤ –ë–î
- –°–æ–∑–¥–∞–Ω cron job –¥–ª—è —Å–±–æ—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Ü–µ–Ω

### [2025-10-XX] - CRUD —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π CRUD –¥–ª—è –∞—Ä—Ç–∏–∫—É–ª–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ª–æ–≥–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –∏ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

### [2025-10-XX] - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase Auth
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è API

### [2025-10-XX] - MVP –∑–∞–ø—É—Å–∫
- –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª Telegram –±–æ—Ç–∞
- Backend API –Ω–∞ FastAPI
- Frontend –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –Ω–∞ React
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

