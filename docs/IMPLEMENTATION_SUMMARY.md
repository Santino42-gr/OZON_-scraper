# üìã –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 2025-10-20  
**–ó–∞–¥–∞—á–∏:** AIL-285, AIL-305  
**–¢–µ–º–∞:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ OZON –±–æ—Ç–∞

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ

### ‚ùå –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**Seller API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã:**
- –¢—Ä–µ–±—É–µ—Ç –ª–∏—á–Ω—ã–µ credentials (Client-Id + API-Key) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í –±–æ—Ç–µ –Ω–∞ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π = 100 –Ω–∞–±–æ—Ä–æ–≤ credentials
- ENV —Ñ–∞–π–ª –æ–±—â–∏–π ‚Üí —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
- **–í—ã–≤–æ–¥:** Seller API –ù–ï –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –±–æ—Ç–∞

### ‚úÖ –ü—Ä–∏–Ω—è—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**Web Scraping + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Ü–µ–Ω:**

1. **Playwright Web Scraping** - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:
   - –¶–µ–Ω—ã —Å/–±–µ–∑ Ozon Card
   - –ù–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
   - –†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã
   - –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ credentials

2. **Cron Job –¥–ª—è —Å–±–æ—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏:**
   - –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞ (03:00)
   - Scraping —Ü–µ–Ω –≤—Å–µ—Ö –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –∞—Ä—Ç–∏–∫—É–ª–æ–≤
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (`ozon_scraper_price_history`)
   - –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ = SQL AVG –∑–∞ 7 –¥–Ω–µ–π

3. **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
   - ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç credentials –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - ‚úÖ –ï–¥–∏–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è –≤—Å–µ—Ö
   - ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
   - ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (—Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `ozon_scraper_`)

#### ‚úÖ `docs/migrations/004_ozon_scraper_price_history.sql`
**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
- –¢–∞–±–ª–∏—Ü–∞ `ozon_scraper_price_history` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Ü–µ–Ω
- SQL —Ñ—É–Ω–∫—Ü–∏—è `get_average_price_7days(article, days)` - —Ä–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–π
- SQL —Ñ—É–Ω–∫—Ü–∏—è `get_price_history(article, days)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
- SQL —Ñ—É–Ω–∫—Ü–∏—è `cleanup_old_price_history()` - –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (>30 –¥–Ω–µ–π)
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:**
```sql
- article_number VARCHAR(255)
- price DECIMAL(10,2)              -- –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–Ω–∞
- normal_price DECIMAL(10,2)       -- –±–µ–∑ Ozon Card
- ozon_card_price DECIMAL(10,2)    -- —Å Ozon Card  
- old_price DECIMAL(10,2)          -- –ø–µ—Ä–µ—á–µ—Ä–∫–Ω—É—Ç–∞—è
- price_date TIMESTAMP
- scraping_success BOOLEAN
- product_available BOOLEAN
- rating, reviews_count
```

#### ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ 001, 002, 003
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ—Ñ–∏–∫—Å `ozon_scraper_` –∫–æ –≤—Å–µ–º —Ç–∞–±–ª–∏—Ü–∞–º:
  - `users` ‚Üí `ozon_scraper_users`
  - `admins` ‚Üí `ozon_scraper_admins`
  - `articles` ‚Üí `ozon_scraper_articles`
  - `request_history` ‚Üí `ozon_scraper_request_history`
  - `logs` ‚Üí `ozon_scraper_logs`

**–§–∞–π–ª—ã:**
- `001_initial_schema_UPDATED.sql`
- `002_rls_policies_UPDATED.sql`
- `003_seed_data_UPDATED.sql`

---

### 2. Cron Jobs

#### ‚úÖ `backend/cron_jobs/price_history_collector.py`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Ü–µ–Ω

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∞—Ä—Ç–∏–∫—É–ª—ã –∏–∑ –ë–î
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ: Playwright scraping —Ü–µ–Ω—ã
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ `ozon_scraper_price_history`
4. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```python
OZON_SCRAPER_BATCH_SIZE=10    # –∞—Ä—Ç–∏–∫—É–ª–æ–≤ –≤ batch
OZON_SCRAPER_DELAY=5          # –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (—Å–µ–∫)
```

**–ó–∞–ø—É—Å–∫:**
```bash
python -m cron_jobs.price_history_collector
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- Total articles processed
- Successful / Failed
- Duration
- Success rate

#### ‚úÖ `backend/cron_jobs/cleanup_old_data.py`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ß—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è:**
- –ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω > 30 –¥–Ω–µ–π
- –õ–æ–≥–∏ > 90 –¥–Ω–µ–π
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ > 30 –¥–Ω–µ–π

**–ó–∞–ø—É—Å–∫:** –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 04:00)

---

### 3. Docker Configuration

#### ‚úÖ `docker-compose.cron.yml`
**–°–µ—Ä–≤–∏—Å:** `cron-worker`

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:**
- `0 3 * * *` - Price History Collection (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ 03:00)
- `0 4 * * 0` - Data Cleanup (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 04:00)

**–ó–∞–ø—É—Å–∫:**
```bash
docker-compose -f docker-compose.yml -f docker-compose.cron.yml up -d
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
docker-compose logs -f cron-worker
```

---

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### ‚úÖ `backend/cron_jobs/README.md`
**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- –û–±–∑–æ—Ä –≤—Å–µ—Ö cron jobs
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- Template –¥–ª—è –Ω–æ–≤—ã—Ö jobs
- Troubleshooting

#### ‚úÖ `docs/CRON_SETUP.md`
**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–º–∏–≥—Ä–∞—Ü–∏–∏, ENV, Docker)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–ø—É—Å–∫–∞:
  - GitHub Actions (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
  - –°–∏—Å—Ç–µ–º–Ω—ã–π Cron (Linux/Mac)
  - –í—Ä—É—á–Ω—É—é (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞
- SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- Troubleshooting
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ Linear –∑–∞–¥–∞—á–∏

### AIL-285: "–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å OZON Web Scraper (Playwright)"
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–±—Ä–∞–Ω–æ: "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OZON API"
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: Web Scraping –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: Cron Job –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Ü–µ–Ω
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: SQL —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ä–µ–¥–Ω–µ–π

**–ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Playwright scraping —Å –æ–±—Ö–æ–¥–æ–º –∞–Ω—Ç–∏–±–æ—Ç
- –ü–∞—Ä—Å–∏–Ω–≥ —Ü–µ–Ω —Å/–±–µ–∑ Ozon Card
- Batch processing –∞—Ä—Ç–∏–∫—É–ª–æ–≤
- Rate limiting (10-15 req/min)
- In-memory –∫—ç—à (TTL 1 —á–∞—Å)

### AIL-305: "–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Ü–µ–Ω–∞—Ö"
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–±—Ä–∞–Ω–æ: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π –∏–∑ Seller API
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: –°–±–æ—Ä —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ Cron Job
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: SQL —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ä–µ–¥–Ω–µ–π

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–ª–∞–Ω:**
1. –¢–∞–±–ª–∏—Ü–∞ `ozon_scraper_price_history` ‚úÖ
2. Cron Job –¥–ª—è —Å–±–æ—Ä–∞ —Ü–µ–Ω ‚úÖ
3. SQL —Ñ—É–Ω–∫—Ü–∏–∏ ‚úÖ
4. Playwright –ø–∞—Ä—Å–∏–Ω–≥ —Ü–µ–Ω (–æ–∂–∏–¥–∞–µ—Ç AIL-285)
5. API endpoints (—Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø)

---

## üìä SQL –§—É–Ω–∫—Ü–∏–∏

### –ü–æ–ª—É—á–∏—Ç—å —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –∑–∞ 7 –¥–Ω–µ–π
```sql
SELECT * FROM get_average_price_7days('ARTICLE-123', 7);

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- article_number | avg_price | avg_normal_price | avg_ozon_card_price | 
-- min_price | max_price | data_points | first_date | last_date
```

### –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
```sql
SELECT * FROM get_price_history('ARTICLE-123', 30, 100);

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- price_date | price | normal_price | ozon_card_price | 
-- old_price | product_available
```

### –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
```sql
SELECT cleanup_old_price_history();
-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
```

---

## üöÄ –°–ø–æ—Å–æ–±—ã –∑–∞–ø—É—Å–∫–∞ Cron Job

### 1. GitHub Actions (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –õ–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å

**–§–∞–π–ª:** `.github/workflows/price_history_cron.yml`

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** `0 3 * * *` (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00 UTC)

### 2. Docker Compose
```bash
docker-compose -f docker-compose.cron.yml up -d
```

### 3. –°–∏—Å—Ç–µ–º–Ω—ã–π Cron (Linux/Mac)
```bash
crontab -e
# –î–æ–±–∞–≤–∏—Ç—å:
0 3 * * * /usr/local/bin/ozon-price-collector.sh
```

### 4. –í—Ä—É—á–Ω—É—é (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
```bash
cd backend
python -m cron_jobs.price_history_collector
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤
```sql
SELECT 
    timestamp,
    message,
    metadata->'stats' as stats
FROM ozon_scraper_logs
WHERE event_type = 'cron_price_history_collection'
ORDER BY timestamp DESC
LIMIT 10;
```

### Success Rate –∑–∞ 7 –¥–Ω–µ–π
```sql
SELECT 
    DATE(timestamp) as date,
    AVG((metadata->'stats'->>'successful')::int) as avg_successful,
    AVG((metadata->'stats'->>'total_articles')::int) as avg_total,
    ROUND(AVG((metadata->'stats'->>'successful')::float / 
        NULLIF((metadata->'stats'->>'total_articles')::float, 0)) * 100, 2) 
        as success_rate_pct
FROM ozon_scraper_logs
WHERE event_type = 'cron_price_history_collection'
  AND timestamp >= NOW() - INTERVAL '7 days'
GROUP BY DATE(timestamp);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—Ä–∞–Ω–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏
```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞—Ä—Ç–∏–∫—É–ª–∞–º
SELECT 
    article_number,
    COUNT(*) as data_points,
    MIN(price_date) as first_record,
    MAX(price_date) as last_record,
    AVG(price) as avg_price
FROM ozon_scraper_price_history
GROUP BY article_number
ORDER BY data_points DESC;
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —á–∞—Å—Ç–æ—Ç—ã

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ß–∞—Å—Ç–æ—Ç–∞ | Cron | –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (1000 –∞—Ä—Ç–∏–∫—É–ª–æ–≤) |
|----------|---------|------|----------------------------------|
| –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π | 1 —Ä–∞–∑/–¥–µ–Ω—å | `0 3 * * *` | ~1.4 —á–∞—Å–∞ |
| –ê–∫—Ç–∏–≤–Ω—ã–π | 2 —Ä–∞–∑–∞/–¥–µ–Ω—å | `0 3,15 * * *` | ~1.4 —á–∞—Å–∞ √ó 2 |
| –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π | 4 —Ä–∞–∑–∞/–¥–µ–Ω—å | `0 */6 * * *` | ~1.4 —á–∞—Å–∞ √ó 4 |

### –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤—Ä–µ–º–µ–Ω–∏
```
–í—Ä–µ–º—è ‚âà (–ê—Ä—Ç–∏–∫—É–ª–æ–≤ √ó Delay) / 60 –º–∏–Ω—É—Ç

100 –∞—Ä—Ç–∏–∫—É–ª–æ–≤ √ó 5 —Å–µ–∫ = ~8 –º–∏–Ω—É—Ç
500 –∞—Ä—Ç–∏–∫—É–ª–æ–≤ √ó 5 —Å–µ–∫ = ~42 –º–∏–Ω—É—Ç—ã
1000 –∞—Ä—Ç–∏–∫—É–ª–æ–≤ √ó 5 —Å–µ–∫ = ~1.4 —á–∞—Å–∞
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è AIL-285:
1. ‚è≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `OzonScraper` –∫–ª–∞—Å—Å —Å Playwright
2. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º OZON
3. ‚è≥ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤—ã–π —Å–±–æ—Ä –∏—Å—Ç–æ—Ä–∏–∏ (–≤—Ä—É—á–Ω—É—é)
4. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å production cron (GitHub Actions / Docker)

### –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è AIL-305:
1. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OzonScraper —Å Cron Job
2. ‚è≥ API endpoints –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Ü–µ–Ω:
   - `GET /api/v1/articles/{id}/prices`
   - `GET /api/v1/articles/{id}/price-history?days=7`
   - `GET /api/v1/articles/{id}/price-average?days=7`
3. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. ‚è≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

---

## ‚úÖ Checklist —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### –ë–î
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è 004 –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é
- [x] SQL —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### Cron Jobs
- [x] Price History Collector —Å–æ–∑–¥–∞–Ω
- [x] Data Cleanup —Å–æ–∑–¥–∞–Ω
- [x] Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞
- [x] README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] CRON_SETUP.md - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- [x] Backend cron_jobs/README.md
- [x] –ü—Ä–∏–º–µ—Ä—ã SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- [x] Troubleshooting guide

### Linear
- [x] AIL-285 –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (Web Scraping focus)
- [x] AIL-305 –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–∏—Å—Ç–æ—Ä–∏—è —á–µ—Ä–µ–∑ Cron)
- [x] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Credentials
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `SUPABASE_SERVICE_ROLE_KEY` –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ –ë–î
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç –¥–æ—Å—Ç—É–ø
- ‚úÖ –õ–æ–≥–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç sensitive –¥–∞–Ω–Ω—ã—Ö

### Rate Limiting
- ‚úÖ Delay –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (5 —Å–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- ‚úÖ Batch processing (10 –∞—Ä—Ç–∏–∫—É–ª–æ–≤)
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ 403 –æ—à–∏–±–æ–∫

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f cron-worker`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î –ª–æ–≥–∏: `SELECT * FROM ozon_scraper_logs`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ job –≤—Ä—É—á–Ω—É—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
4. –°–º. Troubleshooting –≤ `docs/CRON_SETUP.md`

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `backend/cron_jobs/README.md` - cron jobs
- `docs/CRON_SETUP.md` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- `docs/migrations/004_*.sql` - SQL —Ñ—É–Ω–∫—Ü–∏–∏
- `docs/OZON_INTEGRATION.md` - web scraping guide

---

## üéâ –†–µ–∑—é–º–µ

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞:**
- ‚ùå Seller API –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –±–æ—Ç–∞
- ‚úÖ Web Scraping + Cron Job = —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç credentials –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `ozon_scraper_`
- ‚úÖ SQL —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Ü–µ–Ω
- ‚úÖ Cron Jobs –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞
- ‚úÖ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:**
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è OzonScraper (Playwright)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API endpoints
- Production deployment

---

**–ê–≤—Ç–æ—Ä:** AI Agent  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-20  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

